# Лабораторная работа №6: Рефакторинг

## Выявленные структурные недостатки
В ходе анализа базовой реализации были обнаружены следующие проблемные места:

1. Избыточная функциональность в рамках одного метода (функция `process_checkout()`)
   Исходная функция выполняла свыше 50 строк логики, совмещая разбор параметров, проверку корректности, вычисление стоимостей, начисление скидок и налогов, а также генерацию служебных данных. Такая компоновка нарушает принцип единственной ответственности.

2. Наличие неявных числовых констант ("магических чисел")
   В различных участках кода использовались числовые литералы (0.10, 0.20, 0.05, 50, 10, 0.21) без пояснения их семантики, что затрудняло понимание и поддержку логики.

3. Громоздкие условные конструкции
   Алгоритм определения скидки был реализован в виде разветвлённой цепочки из пяти условных операторов `if-elif`, что снижало читаемость и усложняло модификацию правил расчёта.

4. Нарушение принципа единственной ответственности (SRP)
   Один метод был перегружен разнородными задачами, что создавало высокую связанность и затрудняло повторное использование отдельных компонентов логики.

## Применённые методы рефакторинга

1. Декомпозиция метода (Extract Method)
   Монотонная функция `process_checkout()` была разделена на несколько специализированных функций, каждая из которых выполняет чётко определённую задачу:
   - `parse_request()` – извлечение и первичная обработка входных данных
   - `validate_request()` – проверка корректности и полноты запроса
   - `calculate_subtotal()` – вычисление промежуточной суммы
   - `calculate_discount()` – определение и применение скидки
   - `calculate_tax()` – расчёт налоговой составляющей
   - `generate_order_id()` – генерация уникального идентификатора заказа

2. Замена числовых констант именованными значениями (Replace Magic Number with Symbolic Constant)
   Числовые литералы были вынесены в константы с осмысленными именами:
   - `DEFAULT_CURRENCY` для указания валюты по умолчанию
   - `TAX_RATE` для налоговой ставки
   Также были созданы структуры данных для хранения параметров скидочных купонов, что улучшило наглядность.

3. Упрощение сложных условий
   Логика расчёта скидки была частично переработана с использованием подхода, близкого к полиморфизму: данные о типах купонов и правилах их применения были вынесены в отдельные, легко изменяемые структуры. Это позволило локализовать бизнес-правила и упростить их модификацию.

4. Повышение читаемости основного потока выполнения
   После проведённых изменений основная функция `process_checkout()` приобрела структуру, напоминающую последовательный сценарий (pipeline), где каждый шаг логически отделён и имеет явное назначение. Это существенно упрощает восприятие алгоритма в целом.
